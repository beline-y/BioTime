<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BioTIME – Study Map</title>

  <!-- External CSS -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>

<!-- SIDEBAR -->
    <div id="sidebar">
      <div>
        <div class="sidebar-title">BioTIME</div>
        <div class="sidebar-subtitle">Dataset</div>
      </div>

      <div class="sidebar-nav">
        <span class="nav-link active" data-target="page-map">Home</span>
        <span class="nav-link" data-target="page-2">Dataset overview</span>
        <span class="nav-link" data-target="page-3">Studies</span>
      </div>

      <div class="filter-card map-only">
        <div class="filter-header">
          <div class="filter-label">Realm</div>
        </div>
        <div class="filter-body">
          <select id="realm-select">
            <option value="all">All</option>
            <option value="Terrestrial">Terrestrial</option>
            <option value="Marine">Marine</option>
            <option value="Freshwater">Freshwater</option>
          </select>
        </div>
      </div>

      <div class="filter-card map-only">
        <div class="filter-header">
          <div class="filter-label">Protected areas</div>
        </div>
        <div class="filter-body">
          <label class="checkbox-row">
            <input type="checkbox" id="protected-only">
            Protected areas only
          </label>
        </div>
      </div>

      <!-- SIDEBAR page 2 -->
      <div id="phylo-filters-aside" class="filter-card overview-only" style="display:none;">
        <div class="filter-header">
          <div class="filter-label">Phylo domains</div>
          <button id="phylo-select-all" class="mini-btn" type="button">All</button>
        </div>

        <div class="filter-body">
          <div id="phylo-domain-list" class="checklist"></div>
        </div>
      </div>

      <!-- SIDEBAR page 3 -->
      <div id="study-details-aside" class="filter-card study-only" style="display: none;">
          <div class="filter-header">
            <div class="filter-label">Selected Study</div>
          </div>

          <div class="filter-body">
            <select id="study-selector">
              <option value="">Choose an ID...</option>
            </select>
          </div>

          <div id="study-info-sidebar" class="filter-body">
            <p style="font-size: 0.85em; color: #666;">Select a study on the map or via the dropdown.</p>
          </div>
      </div>

      <div id="year-slider-container" class="filter-card study-only" style="display: none; margin-top: 10px;">
        <div class="filter-header">
            <div class="filter-label">Timeline: <span id="current-year-display" style="color: var(--accent); font-weight: bold;">-</span></div>
        </div>
        <div class="filter-body">
            <input type="range" id="year-slider" min="0" max="100" value="0" step="1" style="width: 100%;">
            <div style="display: flex; justify-content: space-between; font-size: 10px; color: var(--text-muted); margin-top: 5px;">
                <span id="year-min">-</span>
                <span id="year-max">-</span>
            </div>
        </div>
      </div>

    </div>

  <div id="main" class = "content">
    <!-- PAGE 1 : CARTE + SIDEBAR -->
    <div id="page-map" class="page-section">

      <!-- MAP -->
      <div id="map-container">
        <div id="tooltip"></div>
        <div id="legend-duration"></div>

        

        <div id="tool-controls">
          <div class="control-label">Selection</div>
          <div class="tool-btn"  id="move" aria-pressed="true">
            <img src = "..//icons//move_icon_64px.png">
          </div>

          <div class="tool-btn tool-rectangle" id="rectangle" aria-pressed="false">
            <img src = "..//icons//rectangle_icon_64px.png">
          </div>
          
          <div class="tool-btn tool-lasso" id="free" aria-pressed="false">
            <img src = "..//icons//lasso_icon_64px.png">
          </div>

          <div id="zoom-controls">
            <div class="control-label">Zoom</div>

            <div class="zoom-btn" id="zoom-in">+</div>
            <div class="zoom-btn" id="zoom-out">−</div>
            <div class="zoom-btn" id="zoom-reset">⟲</div>
          </div>

        </div>

        <!-- ARROW BUTTON FOR NEXT PAGE -->
        <button id="next-page-btn">↓</button>
      </div>

    </div>

    <!-- PAGE 2 : OVERVIEW / GRAPHIQUES -->
    <div id="page-2" class="page-section">
      <!--<h1>Dataset overview</h1>-->
      <div id="kpi-bar" class="kpi-bar"></div>
      <div id="phylo-panel"></div>
      <div id="timeline-panel"></div>
    </div>

    <!-- PAGE 3 : STUDIES OVERVIEW -->
    <div id="page-3" class="page-section">
      <div class="page-header">
        <h1>Study Explorer</h1>
        </div>
      
      <div class="study-layout">
        <div id="map-container-p3" style="position: relative;">
          <div id="zoom-controls" style="position: absolute; right: 15px; top: 15px; z-index: 10; display: flex; flex-direction: column; gap: 5px;">
            <button class="zoom-btn" id="zoom-in-p3">+</button>
            <button class="zoom-btn" id="zoom-out-p3">−</button>
            <button class="zoom-btn" id="zoom-reset-p3">⟲</button>
          </div>
          </div>
      </div>
    </div>

  <!-- Dependencies -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>

  <!-- Main script -->
  <script src="main.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", createViz);
  </script>

</body>
</html>
